# Tagging Tasks

Sometimes, especially when debugging, it can be useful to run just a subset of your tasks. Like, for example right now, whenever we make a change, we're rerunning out entire playbook, which honestly takes a lot of time. So it might be convenient at times just to run some parts of our playbook. And there are few other real-world non-debugging examples of when we would wan to do this.

I'm gonna start by breaking our application to show you an example. I'm going to go onto our virtual machine, inside of my project directory, I'm actually going to change our var directory's permissions, to chmod-R 555 var/, with a sudo in front of that, so it actually works. Then I'm gonna do sudo rf var/cache/* so the var cache director needs to be writable for the application to work. So if I flip over to my browser, it explodes. Now this is not something that would normally happen when we're using our application. We don't expect our permissions to change, but to fix this, we know all we need to do is just rerun our entire playbook, because we have a task in here that fixes those permissions.

However, if this were happening quite often, we might want to wait to just target this one task. A great way to do this is by giving it a tag. So we can say "tags," and then "permissions." And then very simply from the command line, when we execute our playbook on our host machine, at the end we can add a -t for permissions. And when we do that, it'll still do its setup, but it will only run that one task. Boom. You can see it change, and when we refresh, life is good again.

So let me give you a different example. At this time our playbook is broken up of tasks which really do two separate jobs. Some of these tasks are really about setting up the server, making sure PHP and Nginx is installed and configured and we have our extensions and those types of things. But some of the tasks are really more about code deployment: making sure that the project director is there, cloning the code, installing composer dependencies, and setting up our database.

So in the future, we might want to, as we make changes to our code, we might want to just deploy our code but not have to go through all the tasks of setting up the server because we've already done that. So what we're gonna do is we're gonna add a tag called "deploy" to every step in here that's important when we want to update our code. So for example, for the task that actually creates the project directory, we'll add the deploy tag. Checkout Git Repository, that counts, and then the three tasks that install a composer also count because we obviously need to make sure that composer is on the machine. You could not put those in the deploy if you want to and assume that you've already run that; it's up to you.

Installing the composer's dependencies, definitely. Setting up the Nginx configuration is not something that should just be done once. Fixing the permissions, yes, so we'll give that task a second tag, and then setting up the database, absolutely, especially the migration task, which will be responsible for adding new tables as we add them.

All right, so let's try this: I'm gonna go overtime virtual machine. I'm gonna quickly edit a file: app/Resources/views/default/index.html.twig, and I'm gonna add a couple of exclamation points into my template and then write and quit that. If you flip over to your browser, that won't show up right now because we're in Symphony's production environment. But if you add app_deb.php to the URL and go into the deb environment, it should say ... yep, "Filter by Tag!" By the way, the app_deb.php file only works because I have modified the logic in the security here to allow things coming from my host machine. Normally you can't access this file from outside machines.

All right, so now we can go to our host machine and we're gonna rerun the ansible pass, this time with -t: deploy, and we'll see how much faster this is. Much, much better, and when you flip over and try your app, boom: our code is reset back to the way it should have been. And in the other hand, sometimes you might want the opposite. You can actually do a -skip-tags deploy. This will do the opposite, in this case, would basically just provision our server by getting everything installed.

Awesome.

